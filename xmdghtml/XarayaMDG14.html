<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE>Error handling</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 1.1.2  (Linux)">
	<META NAME="CREATED" CONTENT="20040815;10450600">
	<META NAME="CHANGEDBY" CONTENT="Scot Gardner">
	<META NAME="CHANGED" CONTENT="20040815;10450600">
	<STYLE>
	<!--
		@page { size: 8.5in 11in; margin-left: 1.25in; margin-right: 1.25in; margin-top: 0.5in; margin-bottom: 0.5in }
		P { margin-bottom: 0.08in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
		P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-US }
		P.cjk { font-family: "Times New Roman", serif; font-size: 12pt; so-language:  }
		P.ctl { font-family: "Times New Roman", serif; font-size: 10pt }
		H1 { margin-left: -0.25in; margin-bottom: 0.04in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
		H1.western { font-family: "Arial", sans-serif; font-size: 16pt; so-language: en-US }
		H1.cjk { font-family: "Times New Roman", serif; font-size: 16pt; so-language:  }
		H1.ctl { font-family: "Times New Roman", serif; font-size: 10pt; font-weight: medium }
		A:link { color: #000000 }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" TEXT="#000000" LINK="#000000" DIR="LTR">
<DIV TYPE=HEADER>
	<P ALIGN=RIGHT STYLE="margin-bottom: 0in">Scot Gardner <SDFIELD TYPE=PAGE SUBTYPE=RANDOM FORMAT=PAGE></SDFIELD></P>
	<P STYLE="margin-bottom: 0.3in"><BR>
	</P>
</DIV>
<UL>
	<LI><H1 CLASS="western" STYLE="page-break-inside: auto">Error
	handling</H1>
</UL>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">Xaraya is capable of error handling through a
powerful exception handling system. Since the <B>PHP</B> language
does not support language-level exceptions, Xaraya provides an
artificial mechanism to deal with exceptions. Xaraya divides
exceptions into two types: system exceptions and user exceptions.
System exceptions are used by Xaraya <B>API</B> functions, but you
can use them if it's meaningful in that such situation; for example
consider the DATABASE_ERROR exception, you are strongly encouraged to
use this exception when a database error occurs and not to use your
own exception. </FONT>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">As another example considers the BAD_PARAM
exception, you should choose to use that exception in your module
functions and <B>API</B> functions when passed parameters are wrong.
Finally, system exceptions are well known exceptions for which Xaraya
can undertake. Xaraya does not know particular actions like logging,
emailing, or user exceptions, and since they are indistinguishable,
Xaraya will treat them, as they were all the same thing. </FONT>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
Another good point of distinction between system and user exceptions
is the fact that you should not leave uncaught user exceptions as you
can do for system exceptions. Hence, you should catch all user
exceptions instead of throwing them back to Xaraya, this is because
user exceptions are the same as soft exceptions, so you could be in
the position of doing other actions and/or returning a properly
formatted error message that will look better than the default Xaraya
exception caught error message. However, it is not illegal to throw
back user exceptions to Xaraya, so fell free to do that if it is the
case. 
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
You should avoid catching system exceptions, except in particular
cases. A system exception is a hard exception, this means that
something very wrong happened and Xaraya should be notified. You can
achieve this simply by throwing back system exceptions. In addition,
there are particular circumstances in which you could and perhaps
should catch system exceptions. 
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">For example consider the <FONT SIZE=2><FONT FACE="Courier New, monospace">xarUserGetVar()</FONT></FONT>
<B>API</B> function: it raises a NO_PERMISSION system exception in
the case you don't have right permission, however you weren't in the
position to get access level for user variables, so it's perfectly
acceptable here to catch this exception and go ahead when it's
meaningful to do so. </FONT>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">Now is the moment to explore how Xaraya permits
you to deal with exceptions. Here we begin by exposing how to catch
exceptions. When a function that potentially can raise exceptions,
outcomes with a void value you MUST check if some exception was
raised. You can do that by calling the <FONT SIZE=2><FONT FACE="Courier New, monospace">xarExceptionMajor()</FONT></FONT>
function and comparing its return value with the XAR_NO_EXCEPTION
constant. If they are different, you know that an exception has been
raised. </FONT>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">The <FONT SIZE=2><FONT FACE="Courier New, monospace">xarExceptioMajor()</FONT></FONT>
return value can assume one of these values: XAR_NO_EXCEPTION,
XAR_USER_EXCEPTION, XAR_SYSTEM_EXCEPTION. The value XAR_NO_EXCEPTION
indicates that no exception was raised, and XAR_USER_EXCEPTION stands
for user exception was raised and XAR_SYSTEM_EXCEPTION stands for
system exception was raised. </FONT>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
When you see that an exception was raised you have two options: throw
it back or handle it. To throw back an exception you have only to
return with a void value. To handle an exception you have to check
for the exception type, id and value if one. 
</P>
<P CLASS="western" STYLE="margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
Consider the following example: 
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><FONT COLOR="#800000">$res</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">xarModFunc(</FONT><FONT COLOR="#008000">'MyModule'</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'user'</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'MyFunc'</FONT><FONT COLOR="#000000">);<BR><B>if</B></FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">(!<B>isset</B>(</FONT><FONT COLOR="#800000">$res</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">&amp;&amp;</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">xarExceptionMajor()</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">!=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">XAR_NO_EXCEPTION)</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">{<BR></FONT><FONT COLOR="#008080">    </FONT><I><FONT COLOR="#ffff00">//
Got an exception</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><B><FONT COLOR="#000000">if</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">(xarExcepionMajor()</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">==</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">XAR_SYSTEM_EXCEPTION)</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">{<BR></FONT><FONT COLOR="#008080">      
 </FONT><FONT COLOR="#000000"><B>return</B>;</FONT><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">// throw back</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><FONT COLOR="#000000">}<BR></FONT><FONT COLOR="#008080">   
</FONT><I><FONT COLOR="#ffff00">// Got a user exception</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><B><FONT COLOR="#000000">if</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">(xarExceptionId()</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">==</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'MyException1'</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">{<BR></FONT><FONT COLOR="#008080">      
 </FONT><FONT COLOR="#800000">$value</FONT><FONT COLOR="#008080"> </FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">xarExceptionValue();<BR></FONT><FONT COLOR="#008080">
       </FONT><FONT COLOR="#800000">$output</FONT><FONT COLOR="#000000">-&gt;Text(</FONT><FONT COLOR="#008000">&quot;Syntax
error at line: &quot;</FONT><FONT COLOR="#000000">.</FONT><FONT COLOR="#800000">$value</FONT><FONT COLOR="#000000">-&gt;lineNumber);<BR></FONT><FONT COLOR="#008080">
   </FONT><FONT COLOR="#000000">}</FONT><FONT COLOR="#008080"> </FONT><B><FONT COLOR="#000000">elseif</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">(xarExceptionId()</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">==</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'MyException2'</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">{<BR></FONT><FONT COLOR="#008080">      
 </FONT><I><FONT COLOR="#ffff00">/*</FONT></I><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">Do something useful */</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><FONT COLOR="#000000">}</FONT><FONT COLOR="#008080"> </FONT><B><FONT COLOR="#000000">else</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">{</FONT><FONT COLOR="#008080"> </FONT><I><FONT COLOR="#ffff00">//
MyException3</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
       </FONT><I><FONT COLOR="#ffff00">/*</FONT></I><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">Do something useful */</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><FONT COLOR="#000000">}<BR></FONT><FONT COLOR="#008080">   
</FONT><I><FONT COLOR="#ffff00">// reset exception status</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><I><FONT COLOR="#ffff00">// NOTE: it's of vital importance
to call this function</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><I><FONT COLOR="#ffff00">//       before returning</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><FONT COLOR="#000000">xarExceptionFree();<BR></FONT><FONT COLOR="#008080">
   </FONT><B><FONT COLOR="#000000">return</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#800000">$output</FONT><FONT COLOR="#000000">-&gt;GetOutput();<BR>}<BR></FONT></FONT><FONT COLOR="#000000"><FONT SIZE=2>
     </FONT></FONT></FONT>
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<FONT COLOR="#000000">To throw exception you use a unique function:
<FONT SIZE=2><FONT FACE="Courier New, monospace">xarExceptionSet()</FONT></FONT>.
You simply call it by passing the exception major, id and value if
one; and after this call, you return void. </FONT>
</P>
<P CLASS="western" STYLE="margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
Consider the following example: 
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<FONT COLOR="#008080">   </FONT><FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><B><FONT COLOR="#000000">class</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">MyException1<BR>{<BR></FONT><FONT COLOR="#008080">
   </FONT><B><FONT COLOR="#000000">var</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#800000">$lineNumber</FONT><FONT COLOR="#000000">;<BR>}<BR><BR></FONT><I><FONT COLOR="#ffff00">/*</FONT></I><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">... */<BR></FONT></I><FONT COLOR="#000000"><BR>MyModule_user_MyFunc()<BR>{<BR></FONT><FONT COLOR="#008080">
   </FONT><I><FONT COLOR="#ffff00">/*</FONT></I><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">... */</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><B><FONT COLOR="#000000">if</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#800000">$syntax</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">==</FONT><FONT COLOR="#008080"> </FONT><FONT COLOR="#000000"><B>false</B>)</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">{<BR></FONT><FONT COLOR="#008080">      
 </FONT><I><FONT COLOR="#ffff00">// Syntax error</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
       </FONT><FONT COLOR="#800000">$exc</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080"> </FONT><B><FONT COLOR="#000000">new</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">MyException1;<BR></FONT><FONT COLOR="#008080">
       </FONT><FONT COLOR="#800000">$exc</FONT><FONT COLOR="#000000">-&gt;lineNumber</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080"> </FONT><FONT COLOR="#800000">$line</FONT><FONT COLOR="#000000">;<BR></FONT><FONT COLOR="#008080">
       </FONT><FONT COLOR="#000000">xarExceptionSet(XAR_USER_EXCEPTION,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'MyException1'</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#800000">$exc</FONT><FONT COLOR="#000000">);<B>return</B>;<BR></FONT><FONT COLOR="#008080">
   </FONT><FONT COLOR="#000000">}<BR></FONT><FONT COLOR="#008080">   
</FONT><I><FONT COLOR="#ffff00">/*</FONT></I><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">... */</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><FONT COLOR="#000000">xarExceptionSet(XAR_USER_EXCEPTION,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'MyException2'</FONT><FONT COLOR="#000000">);<BR></FONT><FONT COLOR="#008080">
   </FONT><I><FONT COLOR="#ffff00">/*</FONT></I><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">... */</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><FONT COLOR="#000000">xarExceptionSet(XAR_USER_EXCEPTION,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'MyException3'</FONT><FONT COLOR="#000000">);<BR></FONT><FONT COLOR="#008080">
   </FONT><I><FONT COLOR="#ffff00">/*</FONT></I><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">... */</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#008080">
   </FONT><B><FONT COLOR="#000000">return</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000"><B>true</B>;<BR>}</FONT></FONT><FONT COLOR="#000000"><FONT SIZE=2>
     </FONT></FONT></FONT>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-bottom: 0in; page-break-inside: auto">
Note that no value is associated to MyException2 and MyException3, so
there is no need to create a class for exception value. As you can
see exception, handling is very powerful but also boring and tedious.
However, you can always choose not to use user exceptions and always
throw back system exceptions. 
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-bottom: 0in; page-break-inside: auto">
<BR>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-bottom: 0in; page-break-inside: auto">
<FONT COLOR="#000000">Keep in mind that good error handling is not
something that to leave for last. It should be part of the
development process. Note that it is wrong not to check exception
status after a call to a function that can potentially raise
something. And note also that if you choose to handle one or more
exceptions you MUST call <FONT SIZE=2><FONT FACE="Courier New, monospace">xarExceptionFree()</FONT></FONT>
before exiting, otherwise the trust relationship on which the
exception handling mechanism is based won't work and you will produce
very bad things. </FONT>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-bottom: 0in; page-break-inside: auto">
<BR>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-bottom: 0in; page-break-inside: auto">
<FONT COLOR="#000000">An ulterior thing for those of you wanting to
code an official Xaraya module: you MUST always check for possibly
raised exceptions and not code with the thought that something will
never happen; you MUST also raise DATABASE_ERROR in every function
that does queries. To get a better understanding of exception
handling functions you should refer to the Xaraya <B>API</B> Command
Reference.</FONT></P>
<DIV TYPE=FOOTER>
	<P ALIGN=CENTER STYLE="margin-top: 0.29in; margin-bottom: 0in"><FONT SIZE=2>All
	boldface terms are defined in the Glossary beginning on page 42</FONT></P>
</DIV>
</BODY>
</HTML>