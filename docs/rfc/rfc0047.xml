<?xml version="1.0" encoding="iso-8859-1"?>
<?xml-stylesheet type="text/xsl" href="rfc2629-new.xsl"?>
		<!DOCTYPE rfc SYSTEM "rfc2629.dtd">

<!-- 
		Supported processing instructions, uncomment the ones you want
-->

<!-- <?rfc private="my private memo"?>	Produce a private memo rather than a Xaraya-standard --> 
<!-- <?rfc editing="yes"?>	Insert a number in each paragraph to ease review comments -->
<!-- <?rfc symrefs="yes"?>	Instead of numeric cross references, use the sections name -->
<!-- <?rfc sortrefs="yes"?> Sort the references -->
<!-- <?rfc parse-xml-in-artwork="yes" ?> Do we want xml is artwork sections parsed (only uncomment if you know what that means) -->
<!-- <?rfc tocdepth="2"?>	 How many levels should be displayed in the TOC (default: 99 -->

<!-- I guess we always want a table of contents -->
<?rfc toc="yes"?>

<rfc xmlns:ed="http://greenbytes.de/2002/rfcedit" number="0047" category="info">
    <!-- number: Fill in the number for the RFC -->
    <!-- obsoletes: Comma separated list of RFC numbers which this one obsoletes -->
    <!-- category: std=standard, bcp=best common practice, info=info, exp=experimental, historic=historic -->
    
    <!-- Front matter is used for identification of author and organization -->
		<front>
				<title>Trackback in Xaraya</title>
				<author initials="J." surname="Robeson" fullname="Johnny Robeson">
						<organization>Xaraya Development Group</organization>
						<address>
								<email>johnny@xaraya.com</email>
								<uri>http://www.xaraya.com</uri>
						</address>
        </author>
        <date month="July" year="2003"/>
        
        <!-- Initiating team for this RFC -->
        <workgroup>Project Management Committee</workgroup>
        
        <!-- List keywords for the RFC here -->
        <keyword>trackback</keyword>
        <keyword>ping</keyword>
        
        <!-- The abstract summarizes in one or two paragraphs the content of the RFC -->
        <abstract>
            <t>
                This RFC documents the trackback functionality in xaraya. Trackback has had
                lots of attention by the growth of blogging lately. The principle of trackback
                can however be applied to other content than just weblogs pretty easily. A 
                thorough understanding of what trackback is and how it should be used is 
                necessary though. This RFC serves two goals:
                <list style="symbols">
                    <t>explain trackback in practical terms, not directly related to xaraya</t>
                    <t>document the specification for implementation of a trackback module for xaraya</t>
                </list>
            </t>
        </abstract>
    </front>
    
    <!-- The middle section is used for the actual content of the RFC -->
    <middle>
        <!-- Introduction is mandatory -->
        <section title="Introduction">
            <t>
                As blogging has become very popular (quick search for
                estimate: between 2.4 and 2.9 million webloggers), it's time to 
                have xaraya be a good backend for blogging.
            </t>
            <t>
                An important part of blogging is the so-called trackback
                facility. In short it can be described as linking the weblogs
                together in a special way to created an <em>interlinked</em> space
                of the weblog entries. It appears that the concept of trackback creates
                some confusion, so we do an attempt to explain it here in simple
                terms and describe how the concept applies to Xaraya.
            </t>
            <t>
                This document is largely based on the specification located 
                here <xref target="refs.1"/>. MT is one of the most widely
                used blogging systems and their implementation is leading for
                most client developers.
            </t>
            
            <section title="What is trackback?">
                <t>
                    From the MT website:
                    <artwork>
                In a nutshell, TrackBack was designed to provide a
                method of notification between websites: it is a
                method of person A saying to person B, "This is
                something you may be interested in." To do that,
                person A sends a TrackBack ping to person B.
                    </artwork>
                </t>
                <t>
                    How does this work in real life? It's convenient
                    to view at it from two distinct goals:
                    <list style="numbers">
                        <t>content aggregation: having one place to read about one topic</t>
                        <t>remote comments: comments on something published elsewhere</t>
                    </list>
                </t>
                <t>
                    The first can be translated into sending a
                    notification the the <em>one place</em> that
                    something is published on a certain topic. The
                    central place functions as the place where this
                    type of content is aggregated. The publisher sends
                    a notification to the central place, stating that
                    something was published. The central place records
                    enough information about the publication so it can
                    be "tracked back"
                </t>
                <t>
                    The second is more pro-active. Someone reads an
                    interesting publication and wants to write a
                    comment about it, or just write something
                    related. Instead of commenting on the site where
                    the publication is, he comments on his own weblog
                    (because it <em>fits</em> his own list of subjects
                    for example. After publishing the comment or the
                    related publication a ping is send to the original
                    location, so the comment can be "tracked back"
                    from that location to the location where the
                    remote comment is.
                </t>
            </section>
        </section>
        
        <section title="Requirements List">
            <t>
                The main objective of this API is to allow a TrackBack enabled site to send TrackBack pings
                and recieve them. Then the system must route them to the appropriate Xaraya content item.
            </t>
                <list style="numbers">
                    <t>Send Trackback Pings</t>
                    <list style="symbols">
                        <t>TrackBack module send out the TrackBack ping</t>
                        <t>Pings are triggered by:</t>
												<list style="symbols">
														<t>creating an item</t>
														<t>modifying an item</t>
														<t>deleting an item</t>
												</list>
                    </list>
                    <t>Receive TrackBack Pings</t>
                    <t>
                        When items on other sites change or are created as a
                        TrackBack to a xaraya item a TrackBack ping is received
                        This ping needs to be handled by xaraya and stored in relation
                        to the item remotely referenced.
                    </t>
                    <list>
                        <t>Receive and parse TrackBack ping</t>
                        <t>Route information (based on URL) to the right module and store the info there</t>
                        <t>Use display hook to display TrackBack links and show the TrackBacks</t>
                    </list>
                    
                    <t>Auto-Discovery of TrackBack Ping URLs</t>
                       <list>
                           <t>
                              When creating a new item, the TrackBack module should offer the 
                              possibility to retrieve trackback info from an url. This can be both
                              manually or automatically 
                           </t>
                       </list>
              </list> 
        </section>
        
        <section title="Sending a TrackBack ping">
            <t><artwork>
                   POST http://www.foo.com/ws.php?type=trackback&amp;tbid=1
                   Content-Type: application/x-www-form-urlencoded
                   title=Foo+Bar&amp;url=http://www.bar.com/&amp;excerpt=My+Excerpt&amp;blog_name=Foo
            </artwork></t>
         
            <t>Successful Response:</t>
            <t><artwork>
                   &lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
                      &lt;response&gt;
                          &lt;error&gt;0&lt;/error&gt;
                      &lt;/response&gt;
            </artwork></t>
            
            <t>Failed Response:</t>
            <t><artwork>
                    &lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
                        &lt;response&gt;
                            &lt;error&gt;1&lt;/error&gt;
                            &lt;message&gt;The error message&lt;/message&gt;
                        &lt;/response&gt;
            </artwork></t>
        </section>
        
        <section title="Receiving a TrackBack ping">
        
            <t>Example TrackBack ping receive</t>
            <t>
               To retrieve the list of pings sent to a particular Xaraya TrackBack Ping URL, 
               send an HTTP GET request to the TrackBack Ping URL with the query string ?__mode=rss
            </t>
            <t>A sample GET request might look like this:</t>
            <t><artwork>
                GET http://www.foo.com/ws.php?type=trackback&amp;tbid=3?__mode=rss
            </artwork></t>
            <t>
               The response to this request will either be an error in the same format as returned 
               from the above request, or the list of TrackBack pings for that item in RSS markup, 
               wrapped in &lt;response&gt; tags.
            </t>
            <t>For example:</t>
            <t><artwork>
                &lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
                    &lt;response&gt;
                        &lt;error&gt;0&lt;/error&gt;
                        &lt;rss version=&quot;0.91&quot;&gt;
                            &lt;channel&gt;
                                &lt;title&gt;TrackBack Test&lt;/title&gt;
                                &lt;link&gt;http://this.is/the/trackback/item/link/&lt;/link&gt;
                                &lt;description&gt;Description of the TrackBack item&lt;/description&gt;
                                &lt;language&gt;en-us&lt;/language&gt;
                                &lt;item&gt;
                                    &lt;title&gt;TrackBack Demo&lt;/title&gt;
                                    &lt;link&gt;http://this.is/the/permalink/&lt;/link&gt;
                                    &lt;description&gt;Excerpt&lt;/description&gt;
                                &lt;/item&gt;
                            &lt;/channel&gt;      
                        &lt;/rss&gt;
                    &lt;/response&gt;            
            </artwork></t>
            <t>
                The portions between &lt;rss&gt; and &lt;/rss&gt; are the actual RSS data; the rest is simply 
                the response wrapper, and can be discarded.
            </t>
        </section>
        
        <section title="TrackBack Auto-Discovery">
            <t>
               TrackBack clients need a method of determining the TrackBack Ping URL for a particular URL 
               or weblog entry. Server implementations should include embedded RDF in the pages they 
               produce; the RDF represents metadata about an entry, allowing clients to auto-discover 
               the TrackBack Ping URL.
            </t>
            <t>Sample RDF looks like this:</t>
            <t><artwork>
                &lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;
                      xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;
                      xmlns:trackback=&quot;http://madskills.com/public/xml/rss/module/trackback/&quot;&gt;

                &lt;rdf:Description
                rdf:about=&quot;http://www.foo.com/archive.html#foo&quot;
                dc:identifer=&quot;http://www.foo.com/archive.html#foo&quot;
                dc:title=&quot;Foo Bar&quot;
                trackback:ping=&quot;http://www.foo.com/tb.cgi/5&quot; /&gt;
                &lt;/rdf:RDF&gt;
            </artwork></t>
            <t>
               The dc: elements are standard Dublin Core elements; the trackback:ping element comes from the 
               TrackBack Module for RSS 1.0/2.0 at http://madskills.com/public/xml/rss/module/trackback/.
            </t>
            <t>Given a URL my_url, clients should follow these steps:</t>
            <list style="numbers">
                <t>Send an HTTP GET request to retrieve the contents of the page at my_url.</t>
                <t>
                   Scan the page contents for embedded RDF. Pages can contain multiple instances of 
                   embedded RDF--clients should pick the block whose dc:identifier matches my_url.
                </t>
                <t>Extract the trackback:ping value from the block of RDF. This is the TrackBack Ping URL.</t>
            </list>
            <t>
               Once the client has determined the TrackBack Ping URL, it can send a TrackBack ping 
               see Sending a TrackBack Ping.
            </t>
            
            <t>Example Auto-Discovery</t>
            <t><artwork>
               example in javascript:
               window.open('http://your.xaraya.com/ws.php?type=trackback&amp;url=currenturl');
            </artwork></t>
        </section>

        <section title="Solution proposals - database tables">
            <t>xar_trackback_pings:</t>
            <t><artwork>
                CREATE TABLE xar_trackback_pings (
                    pingid INT(11) NOT NULL AUTO_INCREMENT,
                    modid INT(11) NOT NULL DEFAULT 0,
                    itemid INT(11) NOT NULL DEFAULT 0,
                    url INT(255) NOT NULL DEFAULT '',
                    blog_name VARCHAR(255) NOT NULL DEFAULT '',
                    title VARCHAR(255) NOT NULL DEFAULT '',
                    excerpt TEXT,
                    created_by INT(11) NOT NULL DEFAULT 0,
                    created_on INT(11) UNSIGNED NOT NULL DEFAULT 0,
                    modified_by INT(11) NOT NULL DEFAULT 0,
                    modified_on INT(11) UNSIGNED NOT NULL DEFAULT 0,
                    PRIMARY KEY(pingid),
                    INDEX(xar_trackback_pings_modid),
                    INDEX(xar_trackback_pings_itemid),
                    INDEX(xar_trackback_pings_url)
                }
            </artwork></t>
        </section>

        <section title="Solution proposals - functions">
            <t>user:</t>
            <t><artwork>
                trackback_user_display();
            </artwork></t>

            <t>userapi:</t>
            <t><artwork>
                trackback_userapi_getpings();
            </artwork></t>
            <t>admin:</t>
            <t><artwork>
            </artwork></t>

            <t>adminapi:</t>
            <t><artwork>
                trackback_adminapi_sendping();
                trackback_adminapi_
                trackback_adminapi_create();
                trackback_adminapi_delete();
                trackback_adminapi_deleteall();
            </artwork></t>
        </section>

        <section title="Code that will need to be rewritten">
            <t>
            </t>
        </section>

        <section title="Tools that need to be written from scratch">
            <t>
            </t>
        </section>

        <section title="Current Issues">
            <t>
            </t>
        </section>

        <section title="What is a Permalink?">
            <t><artwork>
               permalink (pûrma-lingk) n.
               A permanent marker or reference point to a certain document on the world wide web.
               Most commonly used for weblogs, news sites and newspapers.
               A permalink is denoted through the use of a symbol (pound sign, arrow, dot),
               date of content creation, the word permalink or image.
            </artwork></t>
        </section>

        <!-- Revision history is mandatory -->
        <section title="Revision history">
            <t>2003-07-25: MrB: added TrackBack explanation</t>
            <t>2003-07-24: MrB: created</t>
        </section>

    </middle>

    <!-- Back matter is used for references and appendices which come after the references -->
    <back>
        <references title="Reference title">
            <!-- Fill in references as needed -->
            <reference anchor="refs.1">
                <front>
                    <title>http://www.movabletype.org/docs/mttrackback.html</title>
                    <author>
                        <organization>MovableType</organization>
                    </author>
                    <date year="2002"/>
                </front>
            </reference>
            <reference>
                <front>
                    <title>Reference title</title>
                    <author>
                        <organization>Organization</organization>
                    </author>
                    <date year="2002"/>
                </front>
            </reference>
            <!-- Repeat the aboven block if more references are needed -->
        </references>
        
        <!-- Any section after this will become an appendix -->
        <section title="Example appendix">
            <t>Any section which is present after the references will become an appendix</t>
        </section>
    </back>
</rfc>
