<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="rfc2629.xsl"?>
    <!DOCTYPE rfc SYSTEM "rfc2629.dtd">

<!-- <?rfc private='my private memo'?>  Produce a private memo rather than a Xaraya-standard --> 
<?rfc toc='yes'?>

<rfc number="0007" category="info">
  <front>
    <title>Modularized Data</title>
    <author initials="G." surname="Rothfuss" fullname="Gregor J. Rothfuss">
      <organization>Project Management Core</organization>
      <address>
	<email>gregor@xaraya.com</email>
	<uri>http://www.xaraya.com</uri>
      </address>
    </author>
    <author initials="J." surname="Schrage" fullname="Jan Schrage">
      <organization>Xaraya Development Team</organization>
      <address>
	<email>jan@xaraya.com</email>
	<uri>http://www.xaraya.com</uri>
      </address>
    </author>
    <date month="January" year="2002"/>
    
    <!-- The abstract summarizes in one or two paragraphs the content of the RFC -->
    <abstract>
      <t>This RFC proposes to have a unified mechanism to extend modules with custom data.</t>
    </abstract>
  </front>
  
  <!-- The middle section is used for the actual content of the RFC -->
  <middle>
    <!-- One content section is mandatory -->
    <section title="Introduction">
      <t></t>
    </section>
    <section title="General statements about Modularized Data">
      <t></t>
    </section>
    <section title="List of requirements for Modularized Data">
      <t></t>
    </section>
    <section title=" Solution proposals - database tables">
      <t>
        This is the DB setup as extracted from the admin API.
		<figure><artwork src="images/rfc0007_2.png"/></figure>
     </t>
     <t>   
     This design is for text-based dynamic data.
		<figure><artwork src="images/rfc0007_1.png"/></figure>
		This design is for user data that can be assigned to groups,
        with optional selection lists for fields, i.e. for dropdowns.
		<figure><artwork src="images/rfc0007_3.png"/></figure>
	  </t>
          <t>
	This design attempts to merge Dynamic Data, Dynamic User Data and Module
        Variables. Values are serialized to support transparent storage of complex
        types (arrays etc). Each type has a default BL tag for rendering, which can
        be overwritten in the property. Properties are referenced by module name.
			</t>
		<figure><artwork src="images/rfc0007_5.png"/></figure>
      <t>Proposed change: Remove field "validation": 
Validation aspects should be handled by the data dictionary.
</t>
    </section>
    <section title="Table 'Content'">
      <t></t>
    </section>
    <section title=" Solution proposals - APIs">
      <t>
      Dynamic Data will use two sets of APIs. Creation and Deletion of of variables is done within
      a module, while reading and writing variable contents is done in the core.

      There are currently discussions whether to combine Dynamic User Data with generalized
      Dynamic Data, in essence abstracting away the relationship between users and dynamic
      data, and allowing every module to define its own dynamic data. This brings up the question
      if module variables are being reinvented, and what should happen with the functionality
      to assign responsibility for storing user variables to authentication modules. 

      The current core API functions are:
		<figure><artwork src="images/rfc0007_4.png"/></figure>
      </t>
      <section title="Review of the current DD API with extension proposals">
<list style="hanging">	
	<t>
function dynamicdata_adminapi_createprop($args)
<list>
<t>modid - module id of the item field to create</t>
<t>itemtype - item type of the item field to create</t>
<t>label - name of the field to create</t>
<t>type - type of the field to create</t>
<t>default - default of the field to create</t>
<t>validation - validation of the field to create</t>
</list>
Proposed changes:
Add
<list>
<t>active - boolean: is this property active, i.e. usable?</t>
<t>order -  int: sort order for display</t>
<t>tag - string: BL tag that handles the output</t>
</list>
Delete
<list>
<t>validation: handled by data dictionary</t>
</list>
       </t>
	<t>
function dynamicdata_adminapi_updateprop($args)
<list>
<t>prop_id - property id of the item field to update</t>
<t>modid - module id of the item field to update (optional)</t>
<t>itemtype - item type of the item field to update (optional)</t>
<t>label - name of the field to update</t>
<t>type - type of the field to update</t>
<t>default - default of the field to update (optional)</t>
<t>validation - validation of the field to update (optional)</t>
</list>

Proposed changes:

Add:
<list>
<t>active - boolean: is this property active, i.e. usable?</t>
<t>order -  int: sort order for display</t>
<t>tag - string: BL tag that handles the output</t>
</list>

Delete: 
<list>
<t>modid: A property that belongs to a specific module should remain there</t>
<t>itemtype: Update of item types may break the module logic. 
Should be handled by deletion and new creation</t>
<t>type: Likewise.</t>
<t>validation: handled by data dictionary</t>
</list>
       </t>
	<t>
function dynamicdata_adminapi_deleteprop($args)
<list>
<t>prop_id - property id of the item field to delete</t>
<t>modid - module id of the item field to delete</t>
<t>itemtype - item type of the item field to delete</t>
<t>label - name of the field to delete</t>
<t>type - type of the field to delete</t>
<t>default - default of the field to delete</t>
<t>validation - validation of the field to delete</t>
</list>
Proposed changes:
<list style="bullet">
	      <t>Delete all parameters except prop_id and modid:
For security check ensure a module can delete only its own properties.
It should, however, be allowed to delete any of them.
</t>
	    </list>
        </t>
</list>
<t>
Proposed new functions:

<list>
<t>
function getAllProperties(modid):
get a list of all properties for module $modid
and their basic type and BL tags.
returns array(propid,type,tag)
</t>
</list>
</t>
      </section>
    </section>
    <section title="Proposal for a data dictionary">
      <section title="Purpose">
      <t>The data dictionary should handle basic and module 
dependent types and provide an interface for type checking to modules. 
Modules shall be able to register their own types with validation and display
information.</t>
      </section>
      <section title="Relation to Dynamic Data">
	<t>The data dictionary provides basic type checking and type
handling to all modules, including the dynamic data module. Properties
handled by the dynamic data module should be derived from basic types.
It is, however, intended that display and validation information provided 
by the data
dictionary may be overridden or extended by the property information 
stored in the
dynamic data module to cater to special needs. Example: Derived type jpeg with
basic type binary. Data dictionary validation (binary, maxlen) 
can still be used and complemented by DD validation that checks for 
jpeg headers.</t>
      </section>
<section title="Data dictionary design">
	<t>
DB tables:
       <figure preamble=" DB tables"><artwork src="images/rfc0007_7.png"/></figure>
<list style="bullet">
	    <t>modid - module id</t>
	    <t>type - type name</t>
	    <t>maxlen - maximum storage length</t>
	    <t>blwidget - blocklayout widget to handle this type</t>
	  </list>
      </t>
	
	<t>
API
       <figure preamble="API"><artwork src="images/rfc0007_6.png"/></figure>
      </t>
      </section>
    </section>
    <section title="Relationship to other areas">
      <t>It will need to be determined if it makes sense to allow storage of certain properties
      via the modular authentication system. For instance, it could be beneficial to store
      dynamic properties for the users module in LDAP. Also, it needs to be determined how and
      if dynamic properties integrate with the Multilangue system. Marco has some thoughts about
      this, i hope he will share them soon. Property validation should be done by using the
      facilties provided by xarVarValidate.</t>
    </section>
    <section title="Code that will need to be rewritten">
      <t>xarUserGetVar, xarUserSetVar and xarUserValidateVar will go away, to be replaced
      by xarModGetVar, xarModSetVar, xarVarValidate respectively.</t>
    </section>
    <section title="Tools that need to be created from scratch">
      <t></t>
    </section>
    <section title="Basic documents for this RFC 7">
      <t></t>
    </section>
    <section title="Retractions">
      <t></t>
    </section>
    <section title="Author contact">
      <t></t>
    </section>
    <section title="Changelog">
      <t></t>
    </section>
  </middle>
</rfc>
