<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE>User Variables</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 1.1.2  (Linux)">
	<META NAME="CREATED" CONTENT="20040815;10450600">
	<META NAME="CHANGEDBY" CONTENT="Scot Gardner">
	<META NAME="CHANGED" CONTENT="20040815;10450600">
	<STYLE>
	<!--
		@page { size: 8.5in 11in; margin-left: 1.25in; margin-right: 1.25in; margin-top: 0.5in; margin-bottom: 0.5in }
		P { margin-bottom: 0.08in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
		P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-US }
		P.cjk { font-family: "Times New Roman", serif; font-size: 12pt; so-language:  }
		P.ctl { font-family: "Times New Roman", serif; font-size: 10pt }
		H1 { margin-left: -0.25in; margin-bottom: 0.04in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
		H1.western { font-family: "Arial", sans-serif; font-size: 16pt; so-language: en-US }
		H1.cjk { font-family: "Times New Roman", serif; font-size: 16pt; so-language:  }
		H1.ctl { font-family: "Times New Roman", serif; font-size: 10pt; font-weight: medium }
		A:link { color: #000000 }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" TEXT="#000000" LINK="#000000" DIR="LTR">
<DIV TYPE=HEADER>
	<P ALIGN=RIGHT STYLE="margin-bottom: 0in">Scot Gardner <SDFIELD TYPE=PAGE SUBTYPE=RANDOM FORMAT=PAGE></SDFIELD></P>
	<P STYLE="margin-bottom: 0.3in"><BR>
	</P>
</DIV>
<UL>
	<LI><H1 CLASS="western" STYLE="page-break-inside: auto">User
	Variables</H1>
</UL>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">A user variable is an entity identified by a
name that stores a value owned by exactly one user. Xaraya offers two
<B>API</B> functions to manipulate user variables, they are
<FONT SIZE=2><FONT FACE="Courier New, monospace">xarUserGetVar()</FONT></FONT>
and <FONT SIZE=2><FONT FACE="Courier New, monospace">xarUserSetVar()</FONT></FONT>.
The purpose of <FONT SIZE=2><FONT FACE="Courier New, monospace">xarUserGetVar()</FONT></FONT>
is to allow read access to one user variable. In contrast to that,
<FONT SIZE=2><FONT FACE="Courier New, monospace">xarUserSetVar()</FONT></FONT>
allows write access to one user variable. The <I>$name</I> parameter
is checked against <B>metadata</B> to make sure the variable is
registered. Xaraya keeps some <B>metadata</B> about every user
variable, so you cannot access the <I>$name</I> user variable if its
metadata is not registered. </FONT>
</P>
<P CLASS="western" STYLE="text-indent: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">A module can register a new user variable by
providing its <B>metadata</B> only if it has the right permissions
(permissions are checked by the registration function). Usually the
registration process should take place at initialization time for a
module that wants to use the <I>$name</I> user variable during its
life cycle. </FONT>
</P>
<P CLASS="western" STYLE="margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">Xaraya does not impose any restriction on the
value of <I>$name</I> except for duplicate and reserved names. As of
this writing, the list of reserved names consists of </FONT>
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<B>uid </B>
</P>
<P CLASS="western" STYLE="margin-left: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
The user id. 
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<B>name </B>
</P>
<P CLASS="western" STYLE="margin-left: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
The user display name on the system. &ldquo;Name&rdquo; should be
used in any case that you are displaying the user name, IE author
fields, etc. 
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<B>uname </B>
</P>
<P CLASS="western" STYLE="margin-left: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
The user name is the system variable used to differentiate one user
from another in string vice integer format. This variable should not
be used to display information about the user for consistency and
security reasons. 
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<B>email </B>
</P>
<P CLASS="western" STYLE="margin-left: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
The email address of the user. 
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<B>status </B>
</P>
<P CLASS="western" STYLE="margin-left: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
The status of the user (active, inactive, deleted etc). 
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<B>auth_module </B>
</P>
<P CLASS="western" STYLE="margin-left: 0.5in; margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
The authentication module last used for this user. 
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<FONT COLOR="#000000">You are advised (even for performance reasons)
to use the following naming convention: <I>$name</I> := $module_name
. '_' . $real_name </FONT>
</P>
<P CLASS="western" STYLE="margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">To register the <I>$name</I> user variable you
have to use the module API function <FONT SIZE=2><FONT FACE="Courier New, monospace">register_user_var()</FONT></FONT>
exported by the Modules module. Here is an example: </FONT>
</P>
<P CLASS="western" STYLE="margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<BR><BR>
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<FONT FACE="Courier New, monospace"><FONT SIZE=2 STYLE="font-size: 9pt"><FONT COLOR="#800000">$module_name</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'MyModule'</FONT><FONT COLOR="#000000">;<BR></FONT><FONT COLOR="#800000">$variable_name</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'MaxLinesPerPage'</FONT><FONT COLOR="#000000">;<BR></FONT><FONT COLOR="#800000">$metadata</FONT><FONT COLOR="#000000">[</FONT><FONT COLOR="#008000">'label'</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#800000">$module_name</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">.</FONT><FONT COLOR="#008080"> </FONT><FONT COLOR="#008000">'_'</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">.</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#800000">$variable_name</FONT><FONT COLOR="#000000">;<BR></FONT><FONT COLOR="#800000">$metadata</FONT><FONT COLOR="#000000">[</FONT><FONT COLOR="#008000">'dtype'</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">_UDCONST_INTEGER;</FONT><FONT COLOR="#008080">
</FONT><I><FONT COLOR="#ffff00">//one of the values defined for
dynamic user data variable types</FONT></I><FONT COLOR="#000000"><BR></FONT><FONT COLOR="#800000">$metadata</FONT><FONT COLOR="#000000">[</FONT><FONT COLOR="#008000">'default'</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
<B>20</B></FONT><FONT COLOR="#000000">;<BR></FONT><FONT COLOR="#800000">$metadata</FONT><FONT COLOR="#000000">[</FONT><FONT COLOR="#008000">'validation'</FONT><FONT COLOR="#000000">]</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'num:&gt;=:10&amp;num:&lt;=:100'</FONT><FONT COLOR="#000000">;<BR><BR>xarModAPILoad(</FONT><FONT COLOR="#008000">'Modules'</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'admin'</FONT><FONT COLOR="#000000">);<BR><BR></FONT><FONT COLOR="#800000">$result</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">=</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">xarModAPIFunc(</FONT><FONT COLOR="#008000">'Modules'</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'admin'</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#008000">'register_user_var'</FONT><FONT COLOR="#000000">,</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#800000">$metadata</FONT><FONT COLOR="#000000">);<BR><B>if</B></FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">(!<B>isset</B>(</FONT><FONT COLOR="#800000">$result</FONT><FONT COLOR="#000000">))</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">{<BR></FONT><FONT COLOR="#008080">  </FONT><I><FONT COLOR="#ffff00">//
xarModAPIFunc() failed</FONT></I><FONT COLOR="#000000"><BR>}</FONT><FONT COLOR="#008080">
</FONT><B><FONT COLOR="#000000">elseif</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#800000">$result</FONT><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">==</FONT><FONT COLOR="#008080"> </FONT><FONT COLOR="#000000"><B>false</B>)<BR></FONT><FONT COLOR="#008080">
 </FONT><I><FONT COLOR="#ffff00">// registration failed</FONT></I><FONT COLOR="#000000"><BR>}</FONT><FONT COLOR="#008080">
</FONT><B><FONT COLOR="#000000">else</FONT></B><FONT COLOR="#008080">
</FONT><FONT COLOR="#000000">{<BR></FONT><FONT COLOR="#008080">  </FONT><I><FONT COLOR="#ffff00">//
registration succeeded</FONT></I><FONT COLOR="#000000"><BR>}</FONT></FONT><FONT COLOR="#000000"><FONT SIZE=2>
        </FONT></FONT></FONT>
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<FONT COLOR="#000000">	As you can see in this example, a descriptive
array for the new user variable is created first, and later
register_user_var is called with that array as parameter. Meaningful
keys for the array are label, dtype, default and validation. The
<I>label</I> field is mandatory; it specifies the user variable name
as you'll refer later in <FONT SIZE=2><FONT FACE="Courier New, monospace">xarUserGetVar()</FONT></FONT>
and <FONT SIZE=2><FONT FACE="Courier New, monospace">xarUserSetVar()</FONT></FONT>
<I>$name</I> parameter. The <I>dtype</I> field is mandatory; it can
take one of the following values: _UDCONST_STRING, _UDCONST_TEXT,
_UDCONST_FLOAT, _UDCONST_INTEGER. </FONT>
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<BR>
</P>
<P CLASS="western" STYLE="margin-bottom: 0in; page-break-inside: auto">
<FONT COLOR="#000000">	You should obviously choose the right value
for the data type that the new user variable would contain. The
<I>default</I> field is optional; Used when the user has not yet set
a value for the new user variable. The <I>validation</I> field is
optional; refer to the next section to get an overview of variable
validation. To unregister a user variable you have to call the
<FONT SIZE=2><FONT FACE="Courier New, monospace">unregister_user_var()</FONT></FONT>,
which is located in the users module admin <B>API</B>. You should
call that <B>API</B> only at uninstallation time for your modules.
Keep in mind that by calling <FONT SIZE=2><FONT FACE="Courier New, monospace">unregister_user_var()</FONT></FONT>
all the existing values for that user variable will be deleted from
user data. </FONT>
</P>
<P CLASS="western" STYLE="margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
	As described in this document, Xaraya offers support for module
variables too. If you get confused from that, and cannot see the
distinction between these different things, here is a little
explanation.</P>
<P CLASS="western" STYLE="margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
	Module variables are system-wide variables, shared between each
module user, like configuration variables. No particular user owns
them, and even if they do they are protected by permissions for write
access, they are typically administrative-side variables. You are
encouraged to use them when you have a need to give administrators
the possibility to choose some behaviors of your module. However,
when those behaviors are related to user preferences you should avoid
using module variables and register a new user variable to be used in
your code. 
</P>
<P CLASS="western" STYLE="margin-top: 0.07in; margin-bottom: 0.07in; page-break-inside: auto">
<FONT COLOR="#000000">	As an example, you can consider the above code
listing, where a new user variable is registered to allow every
single module user to choose his own MaxLinePerPage setting. Now it
is reasonable to have selected this choice, but here we could have
chosen a unique shared module var as well. On the other hand, you do
not have this kind of freedom, for example consider the authldap
module in some cases. It needs to access a <B>LDAP</B> server, so it
needs a variable that contains the <B>LDAP</B> server hostname.
Obviously this variable should be a module variable, and access to it
should be granted only to administrators with the right permissions.
We invite you to ponder this issue for a while before you settle on
module vars or user vars. </FONT>
</P>
<DIV TYPE=FOOTER>
	<P ALIGN=CENTER STYLE="margin-top: 0.29in; margin-bottom: 0in"><FONT SIZE=2>All
	boldface terms are defined in the Glossary beginning on page 42</FONT></P>
</DIV>
</BODY>
</HTML>